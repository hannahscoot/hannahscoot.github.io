<html><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><style>body,canvas,html{margin:0;padding:0}body,html{width:100%;height:100%}canvas{display:block;background-color:#000}.dialog{z-index:101;position:absolute;top:20px;left:20px;background-color:#fff;width:220px}.header{background-color:#6e6e6e;text-align:justify}.header:after{content:'';display:inline-block;width:100%;height:0;font-size:0;line-height:0}.header h1{display:inline-block;font-size:140%;font-weight:700;font-family:sans-serif;margin:5px 5px 5px 15px;color:#fff}#showhide{display:inline-block;color:#fff;text-decoration:none;margin-right:10px}#contents{display:block}dl.controls dt{float:left;clear:left;width:60px;text-align:right;font-family:courier}dl.controls dt:after{content:":"}dl.controls dd{color:#6e6e6e;margin:0 10px 0 70px;padding:0 0 .5em 0;font-weight:700;font-family:sans-serif}dl.controls dd a{color:#6e6e6e}dl.inputoptions dt{float:left;clear:left;width:100px;text-align:right}dl.inputoptions dd{margin:0 0 0 110px;padding:0 0 .5em 0;font-family:sans-serif}div.signature{position:absolute;bottom:5px;right:5px;z-index:101;color:#000}div.signature a{text-decoration:none;color:#000}</style><body><canvas id="canvas"></canvas><div class="dialog"><div class="header"><h1>Controls</h1><a href="javascript:void(0)" onclick="showHideControls()" id="showhide">[Hide]</a></div><div id="contents"><dl class="controls"><dt>Drag</dt><dd>Rotate/zoom</dd><dt>C</dt><dd><a href="javascript:void(0)" onclick="toggleColor()" id="shadinglink">Turn off shading</a></dd><dt>S</dt><dd><a href="javascript:void(0)" onclick="changeColorScheme()">Color scheme</a></dd><dt>G</dt><dd><a href="javascript:void(0)" onclick="toggleEmbedding()" id="embeddinglink">Tutte embedding</a></dd></dl><hr><form action=""><dl class="inputoptions"><dt><select id="systemsize" onchange="this.blur()"><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="200">200</option><option value="300">300</option><option value="400">400</option><option value="600">600</option><option value="800">800</option><option value="1000" selected>1000</option><option value="1500">1500</option><option value="2000">2000</option><option value="3000">3000</option><option value="4000">4000</option></select></dt><dd>squares</dd></dl><dl class="controls"><dt>Space</dt><dd><a href="javascript:void(0)" onclick="generate()">Generate new</a></dd></dl></form></div></div><script src="combinatorics.js"></script><script src="colorschemes.js"></script><script>function showHideControls(){"[Hide]"==document.getElementById("showhide").innerHTML?(document.getElementById("showhide").innerHTML="[Show]",document.getElementById("contents").style.display="none"):(document.getElementById("showhide").innerHTML="[Hide]",document.getElementById("contents").style.display="block")}function drawsquare(e,t,o,n,i){drawcolor&&ctx.fillRect(t,o,n,i),drawgraph?(ctx.lineWidth=2,ctx.strokeStyle=0==e.side?"green":"red",ctx.beginPath(),ctx.moveTo(Math.round(t+n/2),o),ctx.lineTo(Math.round(t+n/2),o+i),ctx.stroke(),ctx.strokeStyle="black",ctx.beginPath(),ctx.moveTo(t,o),ctx.lineTo(t+n,o),ctx.stroke(),ctx.beginPath(),ctx.moveTo(t,o+i),ctx.lineTo(t+n,o+i),ctx.stroke()):(ctx.lineWidth=1,ctx.strokeStyle="black",ctx.strokeRect(t,o,n,i))}function getSchemeColor(e,t){var o,n=(t%1+1)%1;if(1==n)o=copyArray(colorschemes[e][colorschemes[e].length-1]);else var i=Math.floor((colorschemes[e].length-1)*n),r=(colorschemes[e].length-1)*n-i,o=[(1-r)*colorschemes[e][i][0]+r*colorschemes[e][i+1][0],(1-r)*colorschemes[e][i][1]+r*colorschemes[e][i+1][1],(1-r)*colorschemes[e][i][2]+r*colorschemes[e][i+1][2]];return"rgb("+Math.round(256*o[0])+","+Math.round(256*o[1])+","+Math.round(256*o[2])+")"}function clampFunction(e){return-3>e?-1:e>3?1:e*(27+e*e)/(27+9*e*e)}function getColor(e,t,o,n){if(0==colorfunctionindex)return getSchemeColor(colorschemeindex,e.order/10);if(1==colorfunctionindex)return getSchemeColor(colorschemeindex,.5+.5*clampFunction(3+.5*Math.log(n*n/(lincomb[0]*lincomb[0]+lincomb[1]*lincomb[1]))));if(2==colorfunctionindex){if(e.width[0]*e.width[0]+e.width[1]*e.width[1]<1e-6)return getSchemeColor(colorschemeindex,0);var i=(lincomb[0]*e.width[0]+lincomb[1]*e.width[1])/Math.sqrt(lincomb[0]*lincomb[0]+lincomb[1]*lincomb[1])/Math.sqrt(e.width[0]*e.width[0]+e.width[1]*e.width[1]);return getSchemeColor(colorschemeindex,Math.abs(i))}if(3==colorfunctionindex){if(e.width[0]*e.width[0]+e.width[1]*e.width[1]<1e-6)return getSchemeColor(colorschemeindex,0);var i=(lincomb[0]*e.width[0]+lincomb[1]*e.width[1])/Math.sqrt(lincomb[0]*lincomb[0]+lincomb[1]*lincomb[1])/Math.sqrt(e.width[0]*e.width[0]+e.width[1]*e.width[1]);return getSchemeColor(colorschemeindex,(i+1)/2)}}function drawSquareEmbedding(){drawcolor?ctx.fillStyle="black":ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height);var e=lincomb[0]*periods[0][0][0]+lincomb[1]*periods[1][0][0],t=lincomb[0]*periods[0][0][1]+lincomb[1]*periods[1][0][1],o=lincomb[0]*periods[0][1][0]+lincomb[1]*periods[1][1][0],n=lincomb[0]*periods[0][1][1]+lincomb[1]*periods[1][1][1],i=1/(t*o-n*e),r=[[i*o,-i*n],[-i*e,i*t]];squares.forEach(function(i){var c=lincomb[0]*i.left[0]+lincomb[1]*i.left[1]+centerX,a=lincomb[0]*i.top[0]+lincomb[1]*i.top[1]+centerY,d=lincomb[0]*i.width[0]+lincomb[1]*i.width[1];ctx.fillStyle=getColor(i,c,a,d),0>d&&(c+=d,a+=d,d=-d);var s=[];s.push(matrixVectorProduct(r,[-c-d,-a-d])),s.push(matrixVectorProduct(r,[-c-d,canvas.height-a+d])),s.push(matrixVectorProduct(r,[canvas.width-c+d,canvas.height-a+d])),s.push(matrixVectorProduct(r,[canvas.width-c+d,-a-d]));var l=getIntegerPointsInPolygon(s);l.forEach(function(r){drawsquare(i,Math.round(c+r[0]*t+r[1]*n),Math.round(a+r[0]*e+r[1]*o),Math.round(d),Math.round(d))})}),drawdomain&&drawDomain(Math.round(t/2),Math.round(e/2),Math.round(n/2),Math.round(o/2))}function drawPoint(e,t,o,n){ctx.fillStyle=n,ctx.fillRect(e-o,t-o,2*o,2*o)}function drawEdge(e,t,o,n,i){ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(t,o),ctx.lineTo(t+n,o+i),ctx.stroke(),drawPoint(t,o,2,"black"),drawPoint(t+n,o+i,2,"black")}function drawHarmonicEmbedding(){ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height),console.log("lincomb",lincomb);var e=[[-lincomb[1],lincomb[0]],[lincomb[0],lincomb[1]]],t=matrixVectorProduct(e,[periods[0][0][0],periods[1][0][0]]),o=matrixVectorProduct(e,[periods[0][1][0],periods[1][1][0]]),n=1/(t[0]*o[1]-o[0]*t[1]),i=[[n*o[1],-n*o[0]],[-n*t[1],n*t[0]]];squares.forEach(function(n){var r=matrixVectorProduct(e,n.top);r[0]+=centerX,r[1]+=centerY;var c=matrixVectorProduct(e,n.width);ctx.strokeStyle=getColor(n,r[0],r[1],c[0]);var a=[[Math.min(r[0],r[0]+c[0]),Math.abs(c[0])],[Math.min(r[1],r[1]+c[1]),Math.abs(c[1])]],d=[];d.push(matrixVectorProduct(i,[-a[0][0]-a[0][1],-a[1][0]-a[1][1]])),d.push(matrixVectorProduct(i,[-a[0][0]-a[0][1],canvas.height-a[1][0]+a[1][1]])),d.push(matrixVectorProduct(i,[canvas.width-a[0][0]+a[0][1],canvas.height-a[1][0]+a[1][1]])),d.push(matrixVectorProduct(i,[canvas.width-a[0][0]+a[0][1],-a[1][0]-a[1][1]]));var s=getIntegerPointsInPolygon(d);s.forEach(function(e){drawEdge(n,Math.round(r[0]+e[0]*t[0]+e[1]*o[0]),Math.round(r[1]+e[0]*t[1]+e[1]*o[1]),Math.round(c[0]),Math.round(c[1]))})}),drawdomain&&drawDomain(Math.round(t[0]/2),Math.round(t[1]/2),Math.round(o[0]/2),Math.round(o[1]/2))}function draw(){0==currentembedding?drawSquareEmbedding():1==currentembedding&&drawHarmonicEmbedding()}function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,centerX=canvas.width/2,centerY=canvas.height/2,requestAFrame(draw)}function processMove(e,t){var o=1/(pointerX*pointerX+pointerY*pointerY);lincomb[0]=o*((e*pointerX+t*pointerY)*oldlincomb[0]-(t*pointerX-e*pointerY)*oldlincomb[1]),lincomb[1]=o*((e*pointerX+t*pointerY)*oldlincomb[1]+(t*pointerX-e*pointerY)*oldlincomb[0]),minradius=.15,lincomb[0]*lincomb[0]+lincomb[1]*lincomb[1]<minradius*minradius*canvas.width*canvas.width&&(factor=minradius*canvas.width/Math.sqrt(lincomb[0]*lincomb[0]+lincomb[1]*lincomb[1]),lincomb[0]*=factor,lincomb[1]*=factor),requestAFrame(draw)}function mouseMove(e){if(drag){var t=e.pageX-this.offsetLeft-centerX,o=e.pageY-this.offsetTop-centerY;processMove(t,o)}}function mouseDown(e){e.preventDefault(),drag=!0,pointerX=e.pageX-this.offsetLeft-centerX,pointerY=e.pageY-this.offsetTop-centerY,oldlincomb[0]=lincomb[0],oldlincomb[1]=lincomb[1]}function mouseUp(e){drag=!1}function touchStart(e){1==e.touches.length&&(pointerX=e.touches[0].pageX-this.offsetLeft-centerX,pointerY=e.touches[0].pageY-this.offsetTop-centerY,oldlincomb[0]=lincomb[0],oldlincomb[1]=lincomb[1])}function touchMove(e){if(1==e.touches.length){var t=e.touches[0].pageX-this.offsetLeft-centerX,o=e.touches[0].pageY-this.offsetTop-centerY;processMove(t,o)}}function keyDown(e){32==e.keyCode?generate():71==e.keyCode?toggleEmbedding():67==e.keyCode?toggleColor():83==e.keyCode&&changeColorScheme()}function toggleEmbedding(){currentembedding++,2==currentembedding&&(currentembedding=0),document.getElementById("embeddinglink").innerHTML=["Tutte embedding","Squaring"][currentembedding],requestAFrame(draw)}function toggleColor(){drawcolor=!drawcolor,document.getElementById("shadinglink").innerHTML=drawcolor?"Turn off shading":"Turn on shading",requestAFrame(draw)}function changeColorScheme(){colorschemeindex++,colorschemeindex==colorschemes.length&&(colorschemeindex=0),requestAFrame(draw)}function generate(e){void 0===e&&(e=parseInt(document.getElementById("systemsize").value)/2),void 0===e&&(e=50);var t=getRandomMatching(e),o=getRandomTorusMatching(e),n=getGenerators(o),i=getRandomCircularInterleave(t.length,o.length),r=getEdges([t,o],i),c=getVertToEdgeMap(r),a=[];a[0]=getClosedForm(t,o,n[0]),a[1]=getClosedForm(t,o,n[1]),requestAFrame(generateAnimationFunction(r,n,t,o,c,a,1))}function generateAnimationFunction(e,t,o,n,i,r,c){return function(){var a=diffuseForm(r[0],i,.001,c),d=diffuseForm(r[1],i,.001,c),s=copyArray(r);if(orthonormalize(s[0],s[1]),periods[0]=getPeriods(e,s[0],t),periods[1]=getPeriods(e,s[1],t),squares=getSquares(s,e,[o,n]),draw(),!a||!d){var l=Math.min(Math.ceil(3e4/o.length),Math.ceil(1.2*c));requestAFrame(generateAnimationFunction(e,t,o,n,i,r,l))}}}function init(){canvas.addEventListener("mousemove",mouseMove,!1),canvas.addEventListener("mousedown",mouseDown,!1),canvas.addEventListener("mouseup",mouseUp,!1),canvas.addEventListener("touchmove",touchMove,!1),canvas.addEventListener("touchstart",touchStart,!1),window.addEventListener("keydown",keyDown,!0),window.addEventListener("resize",resizeCanvas,!1),document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1),resizeCanvas()}var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),currentembedding=0,drawgraph=!1,drawcolor=!0,drawdomain=!1,autorotate=!1,colorschemeindex=6,colorfunctionindex=0,squares=[],periods=[[[0,0],[0,0]],[[0,0],[0,0]]],drag=!1,pointerX,pointerY,centerX=canvas.width/2,centerY=canvas.height/2,lincomb=[500,0],oldlincomb=copyArray(lincomb),lasttimestamp=0,anglepersecond=.2;window.requestAFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}}(),init(),generate();</script></body></html>